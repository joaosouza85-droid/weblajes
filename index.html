<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Cálculo de Lajes Treliçadas</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    label { display: block; margin-top: 10px; }
    input, select { padding: 5px; margin-top: 5px; width: 120px; }
    button { margin-top: 15px; padding: 10px 15px; }
    .resultado { margin-top: 20px; padding: 10px; background-color: #f0f0f0; }
</style>
</head>
<body>
<h2>Cálculo de Lajes Treliçadas</h2>

<div id="entrada">
    <label>Largura da laje (Lx) [m]: <input type="number" id="Lx" step="0.01" value="3.00"></label>
    <label>Comprimento da laje (Ly) [m]: <input type="number" id="Ly" step="0.01" value="4.00"></label>
    <label>Apoio de Viga (apoio) [m]: <input type="number" id="apoio" step="0.01" value="0.14"></label>
    <label>Altura da Laje [Ht]: <input type="number" id="altura_laje" step="0.01" value="0.12"></label>
    <label>Altura da Treliça (h) [m]: 
        <select id="h">
            <option value="0.07" data-bf="0.42">Laje Tr8 (bf=0,42)</option>
            <option value="0.07" data-bf="0.49">Laje Tr8 (bf=0,49)</option>
            <option value="0.12" data-bf="0.42">Laje Tr12 (bf=0,42)</option>
            <option value="0.12" data-bf="0.49">Laje Tr12 (bf=0,49)</option>
            <option value="0.16" data-bf="0.42">Laje Tr16 (bf=0,42)</option>
            <option value="0.16" data-bf="0.49">Laje Tr16 (bf=0,49)</option>
            <option value="0.20" data-bf="0.42">Laje Tr20 (bf=0,42)</option>
            <option value="0.20" data-bf="0.49">Laje Tr20 (bf=0,49)</option>
            <option value="0.25" data-bf="0.42">Laje Tr25 (bf=0,42)</option>
            <option value="0.25" data-bf="0.49">Laje Tr25 (bf=0,49)</option>
            <option value="0.30" data-bf="0.42">Laje Tr30 (bf=0,42)</option>
            <option value="0.30" data-bf="0.49">Laje Tr30 (bf=0,49)</option>
        </select>
    </label>
    <label>Capa de Concreto (hf) [m]: <input type="number" id="hf" step="0.01" value="0.05"></label>
    <label>Tipo de preenchimento: 
        <select id="preenchimento">
            <option value="eps">EPS</option>
            <option value="ceramica">Cerâmica</option>
            
        </select>
    </label>
    <label>Característica do Concreto (Fck) [MPa]: <input type="number" id="Fck" step="0.1" value="25"></label>
    <label>Característica do Aço (Fyk) [MPa]: <input type="number" id="Fyk" step="0.1" value="500"></label>
    <label>Sobrecarga Permanente (qper) [kgf/m²]: <input type="number" id="qper" step="0.1" value="100"></label>
    <label>Sobrecarga Acidental (qacid) [kgf/m²]: <input type="number" id="qacid" step="0.1" value="100"></label>
   
</div>

<div id="resultado" class="resultado" style="display:none;">
    <h3>Resultado:</h3>
    <p id="pp_val">Peso próprio pp: </p>
    <p id="p">Carga total p: </p>
    <p id="max">Momento máximo (Max): </p>
    <p id="maxn">Momento máximo por Nervura (Maxn): </p>
    <p id="Md">Momento de Cálculo (Md): </p>
    <p id="Mdn">Momento de Cálculo (Mdn): </p>
    <p id="x">Posição da linha neutra (x): </p>
    <p id="z">Braço de alavanca (z): </p>
    <p id="x_lim">Limite de posição da linha neutra (x_lim): </p>
    <p id="As">Área de aço (As): </p>
    <p id="Asn">Área de aço por Vigota (Asn): </p>
    <p id="debug" style="font-size: 0.8em; color: #666;"></p>
</div>

<script>
function calcular() {
    // Entradas
    let Lx = parseFloat(document.getElementById("Lx").value);
    let Ly = parseFloat(document.getElementById("Ly").value);
    let apoio = parseFloat(document.getElementById("apoio").value);
    let Ht = parseFloat(document.getElementById("altura_laje").value);
    let h_m = parseFloat(document.getElementById("h").value);
    let hf_m = parseFloat(document.getElementById("hf").value);
    let qper = parseFloat(document.getElementById("qper").value);
    let qacid = parseFloat(document.getElementById("qacid").value);
    let tipo_preenchimento = document.getElementById("preenchimento").value;
    let select = document.getElementById("h");
    let Fck = parseFloat(document.getElementById("Fck").value);
    let Fyk = parseFloat(document.getElementById("Fyk").value);
    let bf = parseFloat(select.options[select.selectedIndex].dataset.bf);

    // Dados fixos
    let vb_m = 0.12; // altura vigota em metrost
    let bw_m = 0.09; // largura vigota em metros
    let densidade_concreto = 2500; // kgf/m³
    let densidade_ceramica = 600; // kgf/m³
    let densidade_eps = 10; // kgf/m³
    let fcd = Fck / 1.4;
    let fyd = Fyk / 1.15;
    let Es = 210000; // MPa
    let ac = 0.85;
    let ec2 = 0.002; // escoamento
    let ecu = 0.0035; // escoamento
    let Astr = 0.277; // área de aço treliça na vigota // criar tabela de treliças
    let d_m = Ht - 0.013; // altura útil considerando cobrimento de 1.3cm
    

    // Determinar densidade do preenchimento
    let densidade_preenchimento = (tipo_preenchimento === "eps") ? densidade_eps : densidade_ceramica;

    // Peso próprio aproximado (kgf/m²)
    // peso_vigota: volume da vigota × densidade (em kgf/m por metro de largura)
    let peso_vigota = densidade_concreto * (Ht - hf_m) * bw_m + (densidade_concreto * 0.03 * 0.015 * 2);
    // peso_capa: volume da capa × densidade (em kgf/m por metro de largura)
    let peso_capa = densidade_concreto * hf_m * bf;
    // peso_preenchimento: volume do preenchimento × densidade (em kgf/m por metro de largura)
    let peso_preenchimento = densidade_preenchimento * (bf - bw_m) * (Ht - hf_m);

    let pp = (1/bf)*(peso_vigota + peso_capa + peso_preenchimento);

    // Carga total (kgf/m²)
    let p = (pp + qper + qacid);
    let pn = bf * (pp + qper + qacid);

    // Momento máximo (kgf·m)
    let Max = (p * Math.pow((Lx + (0.5 *apoio)), 2)) / 8;

      // Momento máximo (kgf·m) por Nervura
    let Maxn = (pn * Math.pow((Lx + (0.5 *apoio)), 2)) / 8;

    // Momento de Cálculo (kgf·m)
    let Md = 1.4 * Max;

    // Momento de Cálculo (kgf·m) por Nervura
    let Mdn = Md * bf;

     // Posição da linha neutra para concretos com Fck ≤ 50 MPa
    // Convertendo Mdn de kgf.m para N.mm: Mdn * 10 * 1000
    let Mdn_Nmm = Mdn * 10000;   
    // fcd em MPa, convertendo para N/mm²
    let fcd_Nmm2 = fcd;
    // bf em m, convertendo para mm
    let bf_mm = bf * 1000;
    // Altura útil (d) considerando cobrimento
    let d = (Ht - 0.013) * 1000; // em mm, considerando cobrimento de 1.3cm
    
    // Verificar se o cálculo é possível (evitar raiz quadrada de número negativo)
    let denominador = 0.425 * bf_mm * Math.pow(d, 2) * fcd_Nmm2;
    let razao = Mdn_Nmm / denominador;
    
    let x_mm = 0; // inicializar
    if (razao <= 1 && denominador > 0) {
        x_mm = 1.25 * d * (1 - Math.sqrt(1 - razao));
    } else {
        x_mm = 0; // Seção sub-armada ou erro nos dados
    }
    
    let x_cm = x_mm / 10; // converter de mm para cm
    
    // Calcular braço de alavanca e força de compressão (após ter x_cm)
    let Fc = (0.85 * fcd) * bw_m * (0.8 * x_cm / 100); // x_cm/100 para converter em m
    let z = d / 100 - 0.4 * x_cm / 100; // converter tudo para metros

    // Limite de posição da linha neutra
    let x_lim = x_cm / (d_m); 

    // cálculo de área de aço 
    let As = Mdn / (fyd * z); // em cm²
    let Asn = As - Astr; // area de aço por vigota em cm² por nervura

    // Mostrar resultados
    document.getElementById("pp_val").innerText = "Peso próprio pp: " + pp.toFixed(3) + " kgf/m²";
    document.getElementById("p").innerText = "Carga total p: " + p.toFixed(3) + " kgf/m²";
    document.getElementById("max").innerText = "Momento máximo (Max): " + Max.toFixed(3) + " kgf·m";
    document.getElementById("maxn").innerText = "Momento máximo por Nervura (Maxn): " + Maxn.toFixed(3) + " kgf·m";
    document.getElementById("Md").innerText = "Momento de Cálculo (Md): " + Md.toFixed(3) + " kgf·m";
    document.getElementById("Mdn").innerText = "Momento de Cálculo (Mdn): " + Mdn.toFixed(3) + " kgf·m";
    document.getElementById("x").innerText = "Posição da linha neutra (x): " + (isNaN(x_cm) ? "Erro no cálculo" : x_cm.toFixed(3)) + " cm";
    document.getElementById("z").innerText = "Braço de alavanca (z): " + (isNaN(z) ? "N/A" : (z * 100).toFixed(3)) + " cm";
    document.getElementById("x_lim").innerText = "Limite de posição da linha neutra (x_lim): " + (isNaN(x_lim) ? "N/A" : (x_lim * 100).toFixed(2)) + " cm";
    document.getElementById("As").innerText = "Área de aço Total (As): " + (isNaN(As) ? "N/A" : As.toFixed(3)) + " cm²";
    document.getElementById("Asn").innerText = "Área de aço por Vigota (Asn): " + (isNaN(Asn) ? "N/A" : Asn.toFixed(3)) + " cm²";

    document.getElementById("resultado").style.display = "block";

}
</script>

<script>
// Debounce helper
function debounce(fn, wait) {
    let t;
    return function(...args) {
        clearTimeout(t);
        t = setTimeout(() => fn.apply(this, args), wait);
    };
}

const autoCalc = debounce(() => {
    if (typeof calcular === 'function') calcular();
}, 200);

['Lx','Ly','apoio','altura_laje','h','hf','preenchimento','Fck','Fyk','qper','qacid'].forEach(id => {
    const el = document.getElementById(id);
    if (!el) return;
    el.addEventListener('input', autoCalc);
    el.addEventListener('change', autoCalc);
});

// Calcular inicialmente
if (typeof calcular === 'function') calcular();
</script>

</body>
</html>
